<!DOCTYPE html>
<html class="main_grid">
	<head>
		<title>gridster test</title>
		<link rel="stylesheet" type="text/css" href="css/gridster.css">
		<link rel="stylesheet" type="text/css" href="css/styles.css">
        <link rel="stylesheet" type="text/css" href="css/jquery-ui.css">
		<a class="menu" href="#">
			<div class="bar"></div>
			<div class="bar"></div>
			<div class="bar"></div>
		</a>
		<nav class="left">
			<ul>
				<li><a href="#">Home</a></li>
				<li><a href="#">Options</a></li>
        		<li><a href="#">Logout</a></li>
			</ul>
		</nav>
	</head>
	<body>
		<section class="grid">
			<div class="gridster" id="frontGrid">
				<ul class='gridlist'>
					<li href="device.php?ip=earlhart.com"  id="first" rel="#overlay" data-row="1" data-col="1" data-sizex="4" data-sizey="2" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
                  		<div class="device_record" >
                        	<h1>Earlhart Soap Works</h1><h2>Earlhart.com</h2><h3>1ms</h3><canvas class="can1"></canvas><div id="statusmark"></div>
						</div>
					</li>
					<li href="device.php?ip=gmail.com" rel="#overlay" data-row="1" data-col="5" data-sizex="4" data-sizey="4" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
						<div class="device_record">
                        	<h1>Gmail Service</h1><h2>gmail.com</h2><h3>1ms</h3><canvas class="can1"></canvas><canvas class="can1 secondImage"></canvas><div id="statusmark"></div>
                        </div>
					</li>
					<li href="device.php?ip=hotmail.com" class="yellow" rel="#overlay" data-row="3" data-col="1" data-sizex="2" data-sizey="2" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
						<div class="device_record">
                        	<h1>Hotmail Service</h1><h2>hotmail.com</h2><h3>1ms</h3><canvas class="can1"></canvas><div id="statusmark"></div>
						</div>
					</li>
					<li href="device.php?ip=digitalpath.net" class="red" rel="#overlay" data-row="3" data-col="3" data-sizex="2" data-sizey="2" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
						<div class="device_record">
                        	<h1>DigitalPath Net</h1><h2>digitalpath.net</h2><h3>1ms</h3><canvas class="can1"></canvas><div id="statusmark"></div>
						</div>
					</li>
					<li href="device.php?ip=chicosystems.com" rel="#overlay" data-row="5" data-col="1" data-sizex="2" data-sizey="2" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
						<div class="device_record">
                        	<h1>Chico Systems</h1><h2>chicosystems.com</h2><h3>1ms</h3><canvas class="can1"></canvas><div id="statusmark"></div>
						</div>
					</li>
					<li href="device.php?ip=news.com" rel="#overlay" data-row="5" data-col="3" data-sizex="4" data-sizey="2" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
						<div class="device_record">
                        	<h1>News</h1><h2>news.com</h2><h3>1ms</h3><canvas class="can1"></canvas><div id="statusmark"></div>
						</div>
					</li>
					<li href="device.php?ip=digg.com" class="yellow" rel="#overlay" data-row="5" data-col="7" data-sizex="1" data-sizey="1" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
                  		<div class="device_record">
                        	<h1>Digg</h1><h2>digg.com</h2><h3>1ms</h3><canvas class="can1"></canvas><div id="statusmark"></div>
						</div>
					</li>
					<li href="device.php?ip=plesk.com" rel="#overlay" data-row="5" data-col="8" data-sizex="1" data-sizey="1" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
						<div class="device_record">
                        	<h1>Plesk</h1><h2>plesk.com</h2><h3>1ms</h3><canvas class="can1"></canvas><div id="statusmark"></div>
						</div>
					</li>
					<li href="device.php?ip=one.com" class="red" rel="#overlay" data-row="6" data-col="7" data-sizex="1" data-sizey="1" onclick="loadDevice('0');">
                    	<img src="images/up-arrow.png" class="grow"><img src="images/down-arrow.png" class="shrink">
						<div class="device_record">
                    		<h1>One</h1><h2>one.com</h2><h3>1ms</h3><canvas class="can1"></canvas><div id="statusmark"></div>
						</div>
                    </li>
                    <li data-row="6" data-col="8" data-sizex="1" data-sizey="1" id="newDeviceOpener">
                    	<div id="addNewDeviceImageContainer">
                    		<img src="images/plus.png" id="addNewDeviceImage">
                        </div>
					</li>
				</ul>
			</div>
			<div class="close"></div>   
            
           <div id="newDeviceDialog" title="Monitor New Device">
 
  <form id="newDeviceForm">
    <fieldset>
      <input type="text" name="deviceName" id="deviceName" placeholder="Device Name" class="text ui-widget-content ui-corner-all">
      <input type="text" name="deviceIP" id="deviceIP" placeholder="Device IP" class="text ui-widget-content ui-corner-all">
      <input type="textarea" name="deviceNote" id="deviceNote" placeholder="Initial Note" class="textarea ui-widget-content ui-corner-all">
 
      <!-- Allow form submission with keyboard without duplicating the dialog button -->
      <!--<input type="submit" id="newDeviceSubmit">-->
    </fieldset>
  </form>
</div>
		</section>
     
		<!-- overlayed element -->
		<div class="apple_overlay" id="overlay">
        
		<!-- the external content is loaded inside this tag -->
		<div class="contentWrap"></div>
        
<script src="js/jquery.tools.min.js"></script>
<script src="js/jquery-ui.js"></script>
<script src="js/hostmonChart.js"></script>
<script type="text/javascript" src="js/jquery.gridster.min.js" charster="utf-8"></script>
<script type="text/javascript">
	var gridster = 0;
	var dragged = 0;
		  
	$(function() {
		gridster = $("#frontGrid > ul").gridster({
			widget_margins: [5, 5],
			widget_base_dimensions: [95, 95],
			min_cols: 8,
			draggable: {
				start: function(event, ui) {
					dragged = 1; //keeps overlay from loading while we are dragging.
				}
			} 
		}).data('gridster');	
		
		 
		  
		c = initializeCanvas("can1");
		for(i = 0; i < c.length; i++){
			canvas = c[i];
			canvas.height = canvas.width/3;
            colorCanvas(canvas, "#51bbff");
            drawGraph(canvas);
		}
		
		function getMessage(result){
			var message = result.substring(0, result.indexOf("|"));	
			return message;
		}
		
		function getDisplay(result){
			var display = result.substring(result.indexOf("|")+1, result.length);
			return display;	
		}
		
		function addNewDevice(newDeviceDialog){
			var deviceName = $("#deviceName").val();
			var deviceIP = $("#deviceIP").val();
			var deviceNote = $("#deviceNote").val();
			
			//alert(deviceName + deviceIP + deviceNote);	
			
			var postData = {addNewDevice:'true',
							deviceName:deviceName,
							deviceIP:deviceIP,
							deviceNote:deviceNote};
		$.ajax({
			type:"POST",
			data : postData,
			url: 'php/grid-backend.php', 
			success: function(result,status,xhr) {
				var message = getMessage(result);
				var display = getDisplay(result);
				if(message.indexOf("DeviceExists") != -1){
					//$(".ui-dialog-title").html("holy crap")
					//alert();
				}
				alert("message: " + message);
				alert("display: " + display);
			},
			complete: function(result,status,xhr) {
				//alert("complete: " + result);
			},
			error: function(xhr,status,error){
				alert("error: " + error);
			}
		});
			
			
			$( newDeviceDialog ).dialog( "close" ); 
			
		}
		  
		function loadDevice(id) {
			if(!dragged){
				//loading the device now happens when user clicks the li[rel]
				//this function only resets the dragged variable now.
			}	// RESET DRAGGED SINCE CLICK EVENT IS FIRED AFTER drag stop
			dragged = 0;
		}
	
		$('.grow').on('click', function(event) {
			event.stopImmediatePropagation(); // this stops the overlay from popping up.
			var grid = gridster;
			var widget = $(this).parent();
			var xSize = widget.attr("data-sizex");
			var ySize = widget.attr("data-sizey");
			var x = 0;
			var y = 0;
			if(xSize == 1 && ySize == 1){
				x = 2;
				y = 2;
			}else if(xSize == 2 && ySize == 2){
				x = 4;
				y = 2;	
			}else if(xSize == 4 && ySize == 2){
				x = 4;
				y = 4;
			}else{ // do nothing, we are as big as we get.
				x = xSize;
				y = ySize;	
			}
			grid.resize_widget(widget, x, y, true);
		});
			  
		$('.shrink').on('click', function(event) {
			event.stopImmediatePropagation(); 
            var grid = gridster;
			var widget = $(this).parent();
			var xSize = widget.attr("data-sizex");
			var ySize = widget.attr("data-sizey");
			var x = 0;
			var y = 0;
			if(xSize == 1 && ySize == 1){ //we are as small as we get, keep this size.
				x = xSize;
				y = ySize;	
			}else if(xSize == 2 && ySize == 2){
				x = 1;
				y = 1;	
			}else if(xSize == 4 && ySize == 2){
				x = 2;
				y = 2;
			}else{ // do nothing, we are as big as we get.
				x = 4;
				y = 2;	
			}
			grid.resize_widget(widget, x, y, true);
      	 });
			  
		$("li[rel]").overlay({
			top:top,
			mask: 'darkred',
			effect: 'apple',
			fixed: false,
			top: '1%',
			onBeforeLoad: function() {
				if(!dragged){
					$('.menu').fadeOut();
					// grab wrapper element inside content
					var wrap = this.getOverlay().find(".contentWrap");
					console.log(wrap);
					// load the page specified in the trigger
					wrap.load(this.getTrigger().attr("href"));
				}
			},
			onClose: function() {
				$('.menu').fadeIn();
				gridster = $("#frontGrid > ul").gridster({
					widget_margins: [5, 5],
					widget_base_dimensions: [95, 95],
					min_cols: 8,
					draggable: {
						start: function(event, ui) {
							dragged = 1;
						}
					}
				}).data('gridster');
			}
		});
		
		//add new device dialogue.
		$( "#newDeviceDialog" ).dialog({
			  autoOpen: false,
			  show: {
				effect: "blind",
				duration: 1000
			  },
			  hide: {
				effect: "explode",
				duration: 1000
			  },
			  buttons: [ { text: "Add Device", click: function() { addNewDevice(this); } } ]
			  
			});
		 
			$( "#newDeviceOpener" ).click(function() {
				//alert("newDeviceOpening");
			  $( "#newDeviceDialog" ).dialog( "open" );
			}); 

		$('.menu').click(function() {
			$('nav').addClass('open');
			$('body').addClass('menu-open');
			return false;
		});
		
		$(document).click(function() {
			$('body').removeClass('menu-open');
			$('nav').removeClass('open');
		});		
	});	  
</script>  
	</body>
</html>